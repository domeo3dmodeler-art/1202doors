# Логика complete-data и расчёта: зафиксированные правила

Ответы на вопросы зафиксированы; реализация приведена в соответствие.

---

## 1. Группировка моделей

- Используется только **«Код модели Domeo (Web)»**.
- **Артикул поставщика** — устаревший параметр, в текущей логике не используется. Группировка и подбор только по коду модели.

---

## 2. Фото обложки модели

**Решение:** Берём **первое фото из «Цвет»** (PropertyPhoto) для данного кода модели. В complete-data при наличии цветов у модели обложка выбирается из первого доступного фото цветов (по коду/фабричному названию).

---

## 3. Опции по модели (реверс, зеркало, порог, наполнение, стекло)

- Доступность: если **хотя бы у одного** товара модели опция доступна — показываем как доступную.
- **Надбавки (руб)** за реверс, зеркало, порог: при разных значениях у разных товаров одной модели берём **максимум**. В complete-data и price/doors используется Math.max.

---

## 4. Кромка по модели

**Решение:** Данные кромки у товаров одной модели могут отличаться. Опции кромки собираются по **всем товарам модели** (объединение): уникальные варианты (цвет, наценка), при одном цвете с разной наценкой берётся **максимальная наценка**. Реализовано в complete-data через edgeOptionsMap по всем products.

---

## 5. Цвета и покрытия

- Каноническое поле цвета в БД — **Цвет/Отделка** (Domeo_Цвет устарел).
- Покрытия в complete-data дополняются из товаров модели (Тип покрытия + Цвет/Отделка).
- **В UI:** один **общий список** цветов/покрытий по модели (без разделения по фабричным названиям).

---

См. также REMAINING_ISSUES.md, DATA_AND_CACHE_RECOMMENDATIONS.md, FULL_SYSTEM_AUDIT.md.
