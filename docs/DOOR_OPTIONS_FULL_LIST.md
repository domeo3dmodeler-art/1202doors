# Все возможные опции дверей

Список составлен по: корзина (`CartItem`), каталог (`properties_data`), конфигуратор/расчёт цены, импорт Final Filled.

---

## Уже в экспорте Excel (колонки)

**Название модели** — первая колонка блока «поля из БД» (сразу после №, Наименование, Количество, Цена, Сумма). Берётся из БД: `properties_data['Название модели']`; если товар не найден — fallback: название по коду модели (`getModelNameByCode`) или `item.model_name`, либо код модели с заменой префикса.

| Колонка Excel       | Источник (корзина / БД) |
|---------------------|--------------------------|
| **Название модели**  | БД: `Название модели`; fallback: код модели / `model_name` |
| Цена опт            | БД / корзина             |
| Цена РРЦ            | БД / корзина             |
| Поставщик           | БД: `Поставщик`; заказ   |
| Материал/Покрытие   | БД: `Материал/Покрытие`, `Тип покрытия`; корзина: `finish` |
| Ширина, мм          | БД: `Ширина/мм`; корзина: `width` |
| Высота, мм          | БД: `Высота/мм`; корзина: `height` |
| Цвет/Отделка        | БД: `Цвет/Отделка`; корзина: `color` |
| SKU внутреннее      | корзина: `sku_1c`; БД: артикул 1С |
| Кромка              | корзина: `edge` (да/нет) |
| Цвет кромки         | корзина: `edgeColorName`, `edgeId` |
| Реверс              | корзина: `reversible`   |
| Зеркало             | корзина: `mirror` (one/both/none) |
| Цвет стекла         | корзина: `glassColor`   |
| Порог               | корзина: `threshold`    |
| Наличники           | корзина: `architraveNames`, `optionNames`, `optionIds` |

---

## Опции из продукта (БД), которых нет в экспорте

Источник: `properties_data` товаров «Межкомнатные двери» (импорт Final Filled, `lib/catalog/doors-model-options.ts`, `lib/price/doors-price-engine.ts`).

| Опция (название для Excel) | Ключ в properties_data | Комментарий |
|----------------------------|--------------------------|-------------|
| **Наполнение**              | `Domeo_Опции_Название_наполнения` | Голд, Сильвер и т.д.; участвует в подборе товара и цене |
| **Код модели Domeo (Web)** | `Код модели Domeo (Web)`         | Код модели для конфигуратора |
| **Толщина, мм**            | `Толщина, мм` или `Толщина/мм`   | Толщина полотна |
| **Стекло (тип)**           | `Стекло`                         | Тип стекла (отдельно от «Цвет стекла») |
| **Кромка в базе**          | `Domeo_Кромка_в_базе_включена`   | Да/Нет — кромка включена в базовую цену |
| **Стиль**                  | `Domeo_Стиль Web`                | Стиль двери (для фильтра/отображения) |

Ценовые/служебные поля опций (для справки, в экспорт обычно не выводят):  
`Domeo_Опции_Надбавка_2301_2500_процент`, `Domeo_Опции_Надбавка_2501_3000_процент`, `Domeo_Опции_Надбавка_реверс_руб`, `Domeo_Опции_Цена_порога_руб`, `Domeo_Опции_Зеркало_одна_сторона_руб`, `Domeo_Опции_Зеркало_две_стороны_руб`, `Domeo_Кромка_базовая_цвет`, `Domeo_Кромка_Цвет_2`…`Цвет_4`, наценки за кромку.

---

## Опции из корзины (фурнитура и доп. позиции), которых нет в экспорте

Источник: `CartItem` (`components/doors/types.ts`), `getItemDisplayName` (`lib/export/export-items.ts`).

| Опция (название для Excel) | Поле корзины        | Комментарий |
|----------------------------|---------------------|-------------|
| **Ручка**                  | `handleName`, `handleId` | Наименование ручки (у двери — одна ручка на позицию) |
| **Комплект фурнитуры**     | `hardwareKitName`, `hardwareKitId` | Базовый, SoftClose и т.д. |
| **Ограничитель**           | `limiterName`, `limiterId` | Наименование ограничителя (отдельная строка или у двери) |
| **Завертка**               | отдельная строка `itemType === 'backplate'` | «Завертка + handleName»; у двери может быть признак/название завертки |

Примечание: в текущем экспорте ручка/ограничитель/завертка попадают в колонку «Наименование» как отдельные строки; отдельной колонки «Ручка» / «Комплект» / «Ограничитель» / «Завертка» в блоке опций двери нет.

---

## Итоговый список «чего не хватает» в Excel

Если добавлять в экспорт **все** возможные опции дверей (кроме уже выведенных), логично добавить колонки:

1. **Наполнение** — из БД: `Domeo_Опции_Название_наполнения`.
2. **Ручка** — из корзины: `handleName` (или по `handleId` из каталога).
3. **Комплект фурнитуры** — из корзины: `hardwareKitName`.
4. **Ограничитель** — из корзины: `limiterName`.
5. **Код модели Domeo (Web)** — из БД: `Код модели Domeo (Web)`.
6. **Толщина, мм** — из БД: `Толщина, мм` / `Толщина/мм`.
7. **Стекло (тип)** — из БД: `Стекло` (тип, не цвет).
8. **Кромка в базе** — из БД: `Domeo_Кромка_в_базе_включена` (Да/Нет).
9. **Завертка** — из корзины: наличие/название завертки (отдельная строка или признак у двери).

Опционально для справки/фильтров:
- **Стиль** — из БД: `Domeo_Стиль Web`.

---

## Где править экспорт

- Заказы поставщика (Excel): `app/api/supplier-orders/[id]/excel/route.ts` — массив `dbFields`, заполнение строк из `fallbackValues` и из найденного товара.
- Документы/заказы (Excel через генератор): `lib/export/puppeteer-generator.ts` — массив `dbFields`, объекты `variantValues` и `fallbackValues`, ветки по `fieldName` при заполнении из `props`.
- Тесты заголовков/колонок: `lib/export/puppeteer-generator.excel.test.ts` — список ожидаемых заголовков и проверки значений по колонкам.

После добавления колонок нужно задать источник значения для каждого поля (БД `props` или корзина `item`) и при необходимости добавить маппинг имён (например, `Толщина/мм` → «Толщина, мм»).

**Устаревшие поля:** В БД не используются «Артикул поставщика», «Звукоизоляция (дБ)» (`Domeo_Опции_Звукоизоляция_дБ`), **«Domeo_Название модели для Web»**. Актуальное поле названия модели — **«Название модели»**; «Domeo_Название модели для Web» в коде только fallback для старых данных. При импорте Final Filled устаревшие поля не записываются (кроме Звукоизоляции — только при наличии колонки в файле).
