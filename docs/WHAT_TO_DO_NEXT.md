# Что делать дальше — одна ВМ, один ключ

**Рабочая staging ВМ:** **http://84.201.160.50:3000** (каталог дверей: http://84.201.160.50:3000/doors)

**ВМ:** 84.201.160.50  
**SSH-ключ:** папка `C:\Users\petr2\.ssh\ssh-key-1771392782781\` (приватный ключ: `ssh-key-1771392782781` без расширения).

Во всех скриптах деплоя уже прописаны этот хост и этот ключ по умолчанию. Переменные окружения задавать не обязательно.

---

## Шаг 1. Проверить SSH

В PowerShell:

```powershell
cd C:\01_conf\1002doors
ssh -i "C:\Users\petr2\.ssh\ssh-key-1771392782781\ssh-key-1771392782781" ubuntu@84.201.160.50 "echo OK"
```

Если выведется **OK** — переходите к шагу 2.

Если **Permission denied** — нужно один раз добавить ваш публичный ключ на ВМ:
1. Консоль Yandex Cloud → Compute Cloud → ВМ 84.201.160.50 → **«Подключиться»** (консоль в браузере).
2. Войти под **ubuntu** (логин/пароль от ВМ).
3. На ПК выполнить: `Get-Content "C:\Users\petr2\.ssh\ssh-key-1771392782781\ssh-key-1771392782781.pub"` — скопировать строку.
4. На ВМ выполнить (подставить свою строку ключа):
   ```bash
   mkdir -p ~/.ssh
   echo "ССЫЛКА_НА_СКОПИРОВАННУЮ_СТРОКУ" >> ~/.ssh/authorized_keys
   chmod 700 ~/.ssh
   chmod 600 ~/.ssh/authorized_keys
   ```
5. В консоли Yandex Cloud: ВМ → **Изменить** → блок **Доступ / SSH-ключи** → добавить ту же строку ключа → сохранить.

---

## Шаг 2. Деплой приложения

В PowerShell из папки проекта:

```powershell
cd C:\01_conf\1002doors
$env:NODE_ENV = ""
npm run deploy:standalone
```

Скрипт соберёт проект, загрузит на ВМ и перезапустит приложение. В конце: `Done. App: http://84.201.160.50:3000`.

---

## Шаг 3. (По желанию) Nginx + Fail2ban на ВМ

После успешного деплоя:

```powershell
npm run apply:vm-security
```

Дальше в группе безопасности Yandex Cloud открыть порт **80**, закрыть с интернета порт **3000**. Подробно: [APPLY_SECURITY_ON_VM.md](./APPLY_SECURITY_ON_VM.md).

---

## Кратко

| Действие | Команда |
|----------|--------|
| Проверить SSH | `ssh -i "C:\Users\petr2\.ssh\ssh-key-1771392782781\ssh-key-1771392782781" ubuntu@84.201.160.50 "echo OK"` |
| Деплой | `cd C:\01_conf\1002doors` → `$env:NODE_ENV=""` → `npm run deploy:standalone` |
| Защита на ВМ | `npm run apply:vm-security` |

Приложение после деплоя: **http://84.201.160.50:3000**
