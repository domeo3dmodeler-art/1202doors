# Покрытия complete-data и кэш: решения

## 1. Покрытия — сделано

- **Каноническое поле цвета:** используется **Цвет/Отделка** (поле Domeo_Цвет устарело).
- В complete-data после заполнения из PropertyPhoto добавлен **проход по товарам модели**: уникальные пары `(Тип покрытия, Цвет/Отделка)` из products дополняют coatings (без фото, если пары не было в PropertyPhoto). Так все варианты из БД попадают в список, расчёт цены и экспорт находят товар.
- В product-match и price-engine цвет берётся из **Цвет/Отделка** (в price-engine fallback Domeo_Цвет оставлен для совместимости старых данных).

---

## 2. Кэш complete-data (30 мин) — решение

- **Документирование:** в инструкции по импорту каталога указать: после загрузки/обновления данных нужно сбросить кэш complete-data: **DELETE** `/api/catalog/doors/complete-data` (с авторизацией) или **?refresh=1** при следующем GET конфигуратора.
- **При импорте через API/скрипт:** в конце операции импорта каталога вызывать сброс кэша (например, внутренний вызов очистки completeDataCache или DELETE endpoint), чтобы после каждого импорта данные в конфигураторе обновлялись без ожидания TTL.
- TTL оставлен 30 мин; при необходимости можно уменьшить (например до 10–15 мин).
