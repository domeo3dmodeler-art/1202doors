# Доступ без входа (без авторизации)

## Как устроена проверка доступа

1. **Middleware (страницы)**  
   Файл `middleware.ts` проверяет только **страницы**, маршруты вида `/api/*` в него не попадают.

   - **Защищённые пути** (без токена — редирект на `/login`):
     - `/admin` (любой подпуть)
     - `/complectator`
     - `/executor`
     - `/universal`
   - **Не защищены на уровне middleware** (страница откроется без входа):
     - `/` — главная
     - `/login` — страница входа
     - `/catalog` — каталог
     - `/doors` — конфигуратор дверей

   Итог: без входа можно открыть главную, логин, каталог и страницу конфигуратора дверей `/doors`. Разделы админки, комплектатора, исполнителя и universal без токена не откроются — будет редирект на `/login`.

2. **API-маршруты**  
   У каждого API-обработчика своя проверка. Многие обёрнуты в `requireAuth()` из `lib/auth/middleware.ts`: при отсутствии или невалидном JWT (cookie `auth-token` или заголовок) возвращается **401** и запрос без входа не выполняется.

---

## Что доступно без входа

### Страницы

- **`/`** — главная (карусель категорий, кнопка входа).
- **`/login`** — форма входа (email/пароль).
- **`/catalog`** — страница каталога (если есть).
- **`/doors`** — конфигуратор дверей: выбор модели, отделки, ручки, ограничителя, корзина, расчёт цены. Страница и её интерфейс доступны без входа.

Остальные страницы (например `/dashboard`, `/clients`, `/documents`, `/orders`) middleware не редиректит, но они завязаны на API с `requireAuth`, поэтому без входа данные не подгрузятся (или будет редирект при 401 через `fetchWithAuth`).

### API, которые работают без токена

Эти маршруты **не** используют `requireAuth` для GET (или вообще для обработчика), поэтому данные по ним доступны без входа:

| Маршрут | Назначение |
|--------|------------|
| `GET /api/catalog/doors/complete-data` | Модели дверей, стили, опции, фото (полные данные для конфигуратора). |
| `GET /api/catalog/hardware?type=handles` | Список ручек. |
| `GET /api/catalog/hardware?type=limiters` | Список ограничителей. |
| `GET /api/catalog/hardware?type=architraves` | Наличники. |
| `GET /api/catalog/hardware?type=kits` | Комплекты фурнитуры. |
| `GET /api/price/doors` | Информация о ценах/расчёт (используется при расчёте в конфигураторе). |
| `POST /api/auth/login` | Вход (email, пароль). |

Конфигуратор дверей (`/doors`) при загрузке хук `useConfiguratorData` дергает именно эти запросы через обычный `fetch()` (без обязательного токена), поэтому каталог моделей, ручки, ограничители, комплекты и расчёт цены работают без входа.

---

## Что недоступно без входа

- Любые API с `requireAuth` (документы, заказы, клиенты, пользователи, экспорт КП/счёта, статистика и т.д.). Без валидного JWT они вернут 401.
- Страницы, которые сами дергают только защищённые API: без входа отобразятся пустыми или с редиректом на логин (в зависимости от того, как обрабатывается 401 в `fetchWithAuth`).
- Разделы `/admin`, `/complectator`, `/executor`, `/universal`: middleware не даст на них попасть без токена (редирект на `/login`).

---

## Поведение на странице «Двери» без входа

- Загружаются: модели дверей, ручки, ограничители, наличники, комплекты фурнитуры, расчёт цены.
- Работают: выбор модели/отделки/цвета/размера, ручка, завертка, ограничитель, добавление в корзину, пересчёт суммы.
- Не работают (требуют авторизации):
  - выбор/список клиентов (например для «Привязать к клиенту»),
  - создание документа (КП/счёт) через «Сформировать КП» / «Сформировать счёт»,
  - экспорт в PDF/Excel и другие действия, идущие через API с `requireAuth`.

То есть конфигуратор и корзина с ценами доступны гостю; создание документов и привязка к клиентам — только после входа.
